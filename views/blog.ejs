<!DOCTYPE html>
<html lang="en">

<head>
    <%- include("./partials/head") %>
    <title><%= blog.title %></title>

    <style>
        .blog-content {
            font-size: 1.2rem;
            line-height: 1.9;
        }

        .half-screen {
            height: calc(100vh - 90px);
            overflow-y: auto;
            padding-right: 15px;
        }

        .cover-image {
            border-radius: 15px;
            box-shadow: rgba(0, 0, 0, 0.15) 0 6px 18px;
            width: 100%;
            max-height: 350px;
            object-fit: cover;
        }

        .comment-card {
            background: #f9f9f9;
            padding: 12px 15px;
            border-radius: 12px;
            box-shadow: rgba(0, 0, 0, 0.04) 0px 2px 6px;
        }

        .comment-input-card {
            background: #ffffff;
            padding: 15px;
            border-radius: 12px;
            box-shadow: rgba(0,0,0,0.05) 0px 3px 10px;
        }

        .author-box {
            background: #f8f9fa;
            padding: 12px 15px;
            border-radius: 12px;
            box-shadow: rgba(0,0,0,0.06) 0px 3px 10px;
        }

        .author-img {
            width: 55px;
            height: 55px;
            object-fit: cover;
            border-radius: 50%;
        }
    </style>
</head>

<body>
    <%- include("./partials/nav") %>

    <!-- ✅ MAIN CONTENT WRAPPER (ONLY ADDITION) -->
    <div class="main-content">
        <div class="container mt-4" style="max-width: 1300px;">
            <div class="row">

                <!-- ===========================================================
                     LEFT HALF — IMAGE + COMMENT FORM + COMMENT LIST
                ============================================================ -->
                <div class="col-md-6 half-screen">

                    <!-- Blog Cover Image -->
                    <% if (blog.coverImageURL) { %>
                        <img src="<%= blog.coverImageURL %>" class="cover-image mb-4" alt="Blog Image">
                    <% } %>

                    <!-- COMMENT SECTION -->
                    <h3 class="fw-bold mb-3">Comments (<%= comments.length %>)</h3>

                    <!-- COMMENT INPUT (TOP) -->
                    <% if (locals.user) { %>
                    <div class="comment-input-card mb-4">
                        <div class="d-flex">

                            <!-- Logged User Image -->
                            <img src="<%= user.profileImageURL %>"
                                 class="rounded-circle me-3"
                                 style="width: 45px; height: 45px; object-fit: cover;">

                            <form action="/blog/comment/<%= blog._id %>" method="post" style="width:100%;">
                                <textarea name="content"
                                    rows="2"
                                    class="form-control mb-2"
                                    placeholder="Write a comment..."
                                    required
                                    style="resize:none;"></textarea>

                                <div class="text-end">
                                    <button class="btn btn-primary btn-sm px-3">Post Comment</button>
                                </div>
                            </form>

                        </div>
                    </div>
                    <% } %>

                    <!-- COMMENT LIST -->
                    <div>
                        <% if (comments.length === 0) { %>
                            <p class="text-muted">No comments yet. Be the first!</p>
                        <% } %>

                        <% comments.forEach(comment => { %>
                            <div class="comment-card mb-3">
                                <div class="d-flex">

                                    <!-- Comment User Image -->
                                    <img src="<%= comment.CREATED_BY?.profileImageURL || '/images/default-profile.png' %>"
                                         class="rounded-circle me-3"
                                         style="width: 40px; height: 40px; object-fit: cover;">

                                    <div>
                                        <b><%= comment.CREATED_BY?.fullName || "User" %></b>
                                        <p class="mb-1"><%= comment.content %></p>
                                    </div>

                                </div>
                            </div>
                        <% }) %>
                    </div>

                </div>

                <!-- ===========================================================
                     RIGHT HALF — BLOG CONTENT + PUBLISHER WITH IMAGE
                ============================================================ -->
                <div class="col-md-6 half-screen">

                    <!-- Blog Title -->
                    <h1 class="fw-bold mb-4" style="font-size: 2.4rem;"><%= blog.title %></h1>

                    <!-- Author Box -->
                    <div class="author-box d-flex align-items-center mb-4">

                        <img src="<%= blog.CREATED_BY?.profileImageURL || '/images/default-profile.png' %>"
                             class="author-img me-3 shadow-sm">

                        <div>
                            <div class="fw-bold" style="font-size: 1.1rem;">
                                <%= blog.CREATED_BY?.fullName || "Unknown Author" %>
                            </div>

                            <div class="text-muted" style="font-size: 0.9rem;">
                                Published on <%= blog.createdAt.toDateString() %>
                            </div>
                        </div>
                    </div>

                    <!-- Blog Content -->
                    <div class="blog-content mt-3">
                        <%= blog.body %>
                    </div>

                    <!-- Tags -->
                    <% if (blog.tags && blog.tags.length > 0) { %>
                        <div class="mt-4">
                            <% blog.tags.forEach(tag => { %>
                                <span class="badge bg-dark me-2 px-3 py-2" style="border-radius: 20px;">
                                    #<%= tag %>
                                </span>
                            <% }) %>
                        </div>
                    <% } %>

                    <!-- Back Button -->
                    <div class="mt-5">
                        <a href="/" class="btn btn-outline-primary px-4">← Back to Home</a>
                    </div>

                </div>

            </div>
        </div>
    </div>
    <!-- ✅ END MAIN CONTENT -->

    <%- include("./partials/footer") %>
    <%- include("./partials/script") %>
</body>

</html>