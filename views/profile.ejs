<!DOCTYPE html>
<html lang="en">
<head>
  <%- include('./partials/head') %>
  <title> My Profile | Blogify</title>

  <style>
    .dashboard-wrapper {
      background: linear-gradient(135deg, #f8f9ff, #ffffff);
      border-radius: 20px;
    }

    .profile-avatar {
      width: 110px;
      height: 110px;
      object-fit: cover;
      border: 4px solid #fff;
      box-shadow: 0 6px 16px rgba(0,0,0,0.12);
    }

    .stat-card {
      background: #fff;
      border-radius: 14px;
      padding: 16px;
      text-align: center;
      border: 1px solid #eee;
    }

    .stat-title {
      font-size: 13px;
      color: #6c757d;
    }

    .stat-value {
      font-weight: 600;
      margin-top: 4px;
    }

    .action-card {
      border-radius: 16px;
      transition: 0.25s ease;
      background: #fff;
      border: 1px solid #eee;
      height: 100%;
    }

    .action-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 28px rgba(0,0,0,0.1);
    }

    .action-icon {
      font-size: 26px;
    }

    .section-title {
      font-weight: 600;
      margin-bottom: 12px;
    }
  </style>
</head>

<body>
<%- include('./partials/nav') %>

<div class="main-content">
  <div class="container mt-5 mb-5">

    <div class="row justify-content-center">
      <div class="col-lg-10 col-md-12">

        <div class="dashboard-wrapper p-4 shadow-sm">

          <!-- PROFILE HEADER -->
          <div class="text-center mb-5">
            <img
              src="<%= user.profileImageURL || '/image/default.png' %>"
              onerror="this.src='/image/default.png'"
              class="rounded-circle profile-avatar mb-3"
            >

            <h4 class="fw-bold mb-1"><%= user.fullName || 'User' %></h4>
            <p class="text-muted mb-2"><%= user.email %></p>

            <% if (user.isPremium) { %>
              <span class="badge bg-success px-3 py-2">‚≠ê Premium Member</span>
            <% } else { %>
              <span class="badge bg-secondary px-3 py-2">Free Plan</span>
            <% } %>
          </div>

          <!-- STATS -->
          <div class="row g-3 mb-5">
            <div class="col-md-6 col-lg-3">
              <div class="stat-card">
                <div class="stat-title">Account Type</div>
                <div class="stat-value">
                  <%= user.googleId ? 'Google Login' : 'Email & Password' %>
                </div>
              </div>
            </div>

            <div class="col-md-6 col-lg-3">
              <div class="stat-card">
                <div class="stat-title">Role</div>
                <div class="stat-value"><%= user.role %></div>
              </div>
            </div>

            <div class="col-md-6 col-lg-3">
              <div class="stat-card">
                <div class="stat-title">Member Since</div>
                <div class="stat-value">
                  <%= new Date(user.createdAt).toDateString() %>
                </div>
              </div>
            </div>

            <div class="col-md-6 col-lg-3">
              <div class="stat-card">
                <div class="stat-title">Subscription</div>
                <div class="stat-value">
                  <%= user.isPremium ? 'Active' : 'Inactive' %>
                </div>
              </div>
            </div>
          </div>

          <!-- ACTIONS -->
          <h5 class="section-title">Quick Actions</h5>

          <div class="row g-4">

            <!-- MY BLOGS -->
            <div class="col-md-6 col-lg-3">
              <a href="/user/my-blogs" class="text-decoration-none text-dark">
                <div class="action-card p-4 text-center">
                  <div class="action-icon mb-2">üìÑ</div>
                  <h6 class="fw-bold">My Blogs</h6>
                  <p class="text-muted small mb-0">
                    View, edit and manage your blogs
                  </p>
                </div>
              </a>
            </div>

            <!-- CHANGE PASSWORD -->
            <% if (!user.googleId) { %>
            <div class="col-md-6 col-lg-3">
              <a href="javascript:void(0)"
                 class="text-decoration-none text-dark"
                 data-bs-toggle="modal"
                 data-bs-target="#changePasswordModal">
                <div class="action-card p-4 text-center">
                  <div class="action-icon mb-2">üîê</div>
                  <h6 class="fw-bold">Change Password</h6>
                  <p class="text-muted small mb-0">
                    Update your account security
                  </p>
                </div>
              </a>
            </div>
            <% } %>

            <!-- ‚úÖ PURCHASE HISTORY (FIXED ‚Äì ALWAYS ACCESSIBLE) -->
            <div class="col-md-6 col-lg-3">
              <a href="/invoices/history" class="text-decoration-none text-dark">
                <div class="action-card p-4 text-center">
                  <div class="action-icon mb-2">üßæ</div>
                  <h6 class="fw-bold">Purchase History</h6>

                  <% if (user.isPremium) { %>
                    <p class="text-muted small mb-0">
                      View all your invoices
                    </p>
                  <% } else { %>
                    <p class="text-muted small mb-0">
                      No active subscription, but past invoices available
                    </p>
                  <% } %>

                </div>
              </a>
            </div>

            <!-- MY SUBSCRIPTION -->
            <div class="col-md-6 col-lg-3">
              <a href="/user/my-plans" class="text-decoration-none text-dark">
                <div class="action-card p-4 text-center">
                  <div class="action-icon mb-2">‚≠ê</div>
                  <h6 class="fw-bold">My Subscription</h6>
                  <p class="text-muted small mb-0">
                    View plan details & billing
                  </p>
                </div>
              </a>
            </div>

          </div>

        </div>

      </div>
    </div>

  </div>
</div>

<!-- CHANGE PASSWORD MODAL -->
<div class="modal fade" id="changePasswordModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 rounded-4">

      <div class="modal-header border-0">
        <h5 class="modal-title fw-bold">Change Password</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body text-center px-4 pb-4">
        <p class="text-muted mb-3">
          To change your password,<br>
          a verification email will be sent to:
        </p>

        <div class="fw-semibold text-primary mb-4">
          <%= user.email %>
        </div>

        <div class="d-flex gap-3 justify-content-center">
          <button class="btn btn-outline-secondary px-4" data-bs-dismiss="modal">
            Cancel
          </button>

          <a href="/user/change-password" class="btn btn-primary px-4">
            Continue
          </a>
        </div>
      </div>

    </div>
  </div>
</div>

<%- include('./partials/footer') %>
<%- include('./partials/script') %>
</body>
</html>